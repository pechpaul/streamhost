name: myPlaybook
  hosts: site
  vars:
    project_path: /var/www/nodejs
  tasks:
    - name: Set some variable
          set_fact:
            release_path: "{{ project_path }}/releases/{{ lookup('pipe','date +%Y%m%d%H%M%S') }}"
            current_path: "{{ project_path }}/current"

    - name: Create new folder
        file:
          dest={{ release_path }}
          mode=0755
          recurse=yes
          state=directory
    - name: Clone the repository
        git:
          repo: git@github.com:USERNAME/REPO.git
          dest: "{{ release_path }}"
    - name: Update npm
      npm:
        path={{ release_path }}